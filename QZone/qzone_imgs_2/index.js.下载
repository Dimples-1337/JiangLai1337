
window.requirejSolution||(window.defineRequirejSolution=function(){var base=window.g_Parent||parent;var map={76:1,20:2,74:3};var exp=base.QZONE.FrontPage.isAlphaUser(true)&&(!base.ua.ie||base.ua.ie>8)?2:(base.location.search!='?debug'&&map[base.g_iLoginUin%100]||0);var stamp={0:20130809,1:20130809,2:20130809,3:20130809};var url=['http://',base.siDomain||'qzonestyle.gtimg.cn','/qzone/app/jSolution/jSolution_1.0_qzone',exp?'_exp_'+exp:'','.js?max_age=31536000&ver=',stamp[exp]].join('');var callbacks=[];var onReady=function(){jSolution('1.0',function(j$){if(callbacks){for(var i=0,j=callbacks.length;i<j;i++){callbacks[i](j$);}
window.requirejSolution=function(callback){callback(j$);callback=null;};url=callbacks=onReady=null;}});};window.requirejSolution=function(callback){callbacks.push(callback);callback=null;if(window.jSolution){onReady();return;}
if(callbacks.length<=1){QZFL.imports([url],onReady);}};window.requirejSolution_url=url;})();/*  |xGv00|20b26fe399d750e07a2c5e85af22822a */(function(){var o=window;try{do{o=o.parent;if(o.QZONE&&o.QZONE.FrontPage&&o.g_iUin){break}}while(o!=top)}catch(o){}if(typeof siDomain=="undefined"){siDomain=o.siDomain||"qzonestyle.gtimg.cn"}g_V=o.g_V||{};g_V.jq=g_V.jq||"1.9.1";g_V.req=g_V.req||"0.0.9";window.g_isGrayRelease=o.g_isGrayRelease||false;window.g_cdn_proto=o.g_cdn_proto||"";window.g_proto=o.g_proto||""})();var seajsConfig={charset:"utf-8",timeout:5*60*1e3,debug:0,paths:{v8:(window.g_cdn_proto||window.location.protocol)+"//"+(window.g_isFrameWorkTestEnv=="1"?"h5.qzone.qq.com/proxy/domain/qzonestyle.gtimg.cn":siDomain)+"/qzone/v8","photo.v7":(window.g_cdn_proto||window.location.protocol)+"//"+(window.g_isFrameWorkTestEnv=="1"?"h5.qzone.qq.com/proxy/domain/qzonestyle.gtimg.cn":siDomain)+"/qzone/photo/v7/js",cssBase:(window.g_cdn_proto||window.location.protocol)+"//"+(window.g_isFrameWorkTestEnv=="1"?"h5.qzone.qq.com/proxy/domain/qzonestyle.gtimg.cn":siDomain),
app:(window.g_cdn_proto||window.location.protocol)+"//"+(window.g_isFrameWorkTestEnv=="1"?"h5.qzone.qq.com/proxy/domain/qzonestyle.gtimg.cn":siDomain)+"/qzone/app",qzact:(window.g_cdn_proto||window.location.protocol)+"//"+siDomain+"/qzone/qzact","mall.v8":(window.g_cdn_proto||window.location.protocol)+"//"+siDomain+"/qzone/mall/v8",hybridPath:(window.g_cdn_proto||window.location.protocol)+"//"+siDomain+"/qzone/hybrid"},alias:{jquery:(window.g_cdn_proto||window.location.protocol)+"//"+siDomain+"/ac/lib/jquery/jquery-"+g_V.jq,"migrate-plugin":"v8/engine/migrate-plugin.js",interface:"v8/core/interface_mini.js",app_engine_base:"v8/core/app_engine_base.js",app_engine:function(){return window.location.protocol+"//"+siDomain+"/c/=/qzone/v8/core/app_engine_base.js,/qzone/v8/core/app_engine"+(window.g_diffModules&&g_diffModules.engine?g_diffModules.engine:"")+"_v2.js?max_age=72000"}(),
changelog_data:(window.g_cdn_proto||window.location.protocol)+"//"+siDomain+"/qzone/v6/v6_config/changelog_data.js","console-plus":"v8/engine/console-plus/console-plus.js",embeded:"/applib/embeded.js",request:"v8/engine/request/request_"+g_V.req},map:[[/^.+\/lib\/jquery\.js$/,(window.g_cdn_proto||window.location.protocol)+"//"+siDomain+"/ac/lib/jquery/jquery-"+g_V.jq+".js"]],comboSyntax:["c/=",","],comboIncludes:/\/qzone\/v8/,comboExcludes:/jquery|app_engine|music|qzone\/v8\/index\/msgboard/,preload:window.isIframe?["jquery","migrate-plugin","console-plus","request"]:["jquery","migrate-plugin","interface","console-plus","app_engine","request"]};window.seajs&&seajs.config(seajsConfig);window.seajs&&seajs.on("resolve",function(o){if((location.protocol==="https:"||window.g_cdn_proto==="https:")&&o&&o.id&&o.refUri&&typeof o.id=="string"&&o.id.indexOf("http://")===0){
if(o.id.indexOf("http://qzs.qzone.qq.com/")==0||o.id.indexOf("http://qzonestyle.gtimg.cn/")==0||o.id.indexOf("http://qzs.qq.com/")==0||o.id.indexOf("http://imgcache.qq.com/")==0){o.id=o.id.replace("http://","https://")}}});
define('tcisd',null,function(require,exports,module){var env=require('app/v8/env/1.0');return env.base.TCISD;});/*  |xGv00|b5a28b2352d4edc95fb47e1acee930e8 */var throttle=function(e,t,o){var n=null;return function(){var i=arguments;clearTimeout(n);setTimeout(function(){e.apply(t,i)},o||100)}};MOOD.interface={callExt:function(e,t){var o=this;if(!QZFL.lang.isArray(t)){t=[t]}seajs.use("app/mood_v6/script/msglist_ext",function(n){throttle(function(){n[e].apply(o,t)},n,200)()})}};QZFL.object.extend(MOOD.util,{goProfile:function(e,t){if(e){switch(t+""){case"3":var o="http://rc.qzone.qq.com/myhome/weibo/profile/"+e;window.open(o,"_blank");break;case"1":default:if(e.length>30){var o="http://www.pengyou.com/index.php?mod=profile&u="+e+"&adtag=from_profile";window.open(o,"_blank")}else{var o="//qzs.qq.com/qzone/app/mood_v6/html/index.html?tab=mine"+(e?"&uin="+e:"");o=o.replace("//qzs.qq.com","//"+location.host+"/proxy/domain/qzs.qq.com");MOOD.util.go(o)}break}}else{var o="//qzs.qq.com/qzone/app/mood_v6/html/index.html?tab=mine";o=o.replace("//qzs.qq.com","//"+location.host+"/proxy/domain/qzs.qq.com");MOOD.util.go(o)}},showMention:function(e,t){
var o="http://"+siDomain+"/qzone/app/mood_v6/api/api.js";QZFL.imports(o,function(){var o=QZFL.FP.removeUBB(escHTML(e));var n=/(?:@\{uin:([^\}]*),nick:([^\},]*)(?:,who:(\d+))?\})|[^@]+/g;o=o.replace(n,function(e,t,o,n){if(t){var i=new MOOD.api.user({nickname:restXHTML(o||t),uin:t,who:n||1});return i.getProfileLink()}return e});var i=$e(".new_comment_content_"+t);i.setHtml(o)})},getDateStr:function(e,t){var o,n,i,a,r,s,c;t=t||"YY-mm-dd";o=e?new Date(e*1e3):new Date;n=o.getFullYear();i=o.getMonth()+1;a=o.getDate();r=o.getHours();s=o.getMinutes();c=o.getSeconds();var l=t.replace("YY",n).replace("mm",i).replace("dd",a).replace("H",r).replace("i",s).replace("s",c);return l},friendlyTime:function(e){var t=new Date(e*1e3);return timeFormatString(t)},voiceFix:function(e){return e?"none":""}});MOOD.event={init:function(){QZFL.event.addEvent(document.body,"click",MOOD.event.clickProxy)},clickProxy:function(e){var o=QZFL.event.getTarget(e);QZFL.dom.searchChain(o,"parentNode",function(e){
if(e==window.document){return false}e=$e(e);if(e.hasClass("goProfile")){MOOD.sendEvent("goProfile");MOOD.util.goProfile(e.getAttr("profileUin"),e.getAttr("profilePft"))}if(e.hasClass("goDetail")){var n=MOOD.lastComment.getItemElement(e);if(!n)return;var i=$e(n).getAttr("tid");mood=MOOD.DataStorage.get(i);if(!mood||!mood.data){return}MOOD.util.go("//qzs.qq.com/qzone/app/mood_v6/html/index.html?ref="+location.pathname+"&_tid="+mood.data.tid,{uin:mood.data.uin,tid:mood.data.tid,source:mood.data.t1_source})}if(e.hasClass("goSearch")){MOOD.sendEvent("goSearch");setTimeout(function(){MOOD.topic.search(e.getAttr("keyword"))},100);return false}if(e.hasClass("last_comment_button")){MOOD.lastComment.popupComment(e);return true}if(e.hasClass("last_retweet_button")){MOOD.lastComment.popupRetweet(e);return true}if(e.hasClass("mod-hot-change")){MOOD.sendHotClick("/hottopic_change");t.refreshHotWords();QZFL.event.preventDefault(e);return true}if(e.hasClass("topic_op_link")){
var a=QZFL.dom.searchElementByClassName(o,"topic_item");t.dolike(a);QZFL.event.preventDefault(e);return true}if(e.hasClass("ico_weibo")){MOOD.sendEvent("guideToWeibo")}if(e.hasClass("ico_qzone")){MOOD.sendEvent("guideToQZone")}if(e.hasClass("go_home")){MOOD.sendEvent("go_home")}})}};MOOD.widget={loadPager:function(e){window.F4A=window.F4A||{};QZFL.imports("http://"+QZONE.FP._t.siDomain+"/qzone/app/controls/pager/pager.js",e)}};MOOD.poster={makeFakeFeed:function(e,o){var n=/(?:@\{uin:([\w-_]+),nick:([^\},]*)(?:,who:(\d+))?\})/;QZFL.console.print("new feed tid:"+e.t1_tid);if(o.skipMsgbox){o.skipMsgbox=false}else if(e.secret&&n.test(e.content)){QZONE.FP.showMsgbox("私密说说发表成功！该条说说仅自己可见，被提及的用户不能收到提醒！",4,3e3)}else{QZONE.FP.showMsgbox("发表成功",4,2e3)}if(o.skipMakeFeed){o.skipMakeFeed=false}else{e.uin=e.t1_uin;e.t1_name=e.t1_uin;e.name=e.t1_name==e.t1_uin?QZONE.FP.getNickname():e.t1_name;e.createTime=e.t1_time;e.tid=e.t1_tid;e.source_name=e.t1_source_name;e.source_url=e.t1_source_url
;e.certified=e.auth_flag||0;MOOD.updateFeeds(e);t.loadVisiableItems()}e.secret&&MOOD.sendEvent("publish_private_mood")},init:function(e){var t;var o=this;qzlog.info({cm:"MOOD_APP",cf:"init MoodPoster START"});seajs.use("app/v8/config/1.0",function(){seajs.use(["app/v8/controls/mood_poster/1.0","app/v8/utils/monitor/1.0","app/v8/controls/mood_poster/mood_editor_config/1.0"],function(e,n,i){t=e.create({needSideBar:true,needSyncQQ:true,needSyncWeibo:false,needSyncSetting:true,needAuthorizeSetting:true,needTimerSetting:true,pluginConfig:{basicPlugins:i.BASIC_PLUGINS,imagePlugins:i.IMAGE_PLUGINS,funnyPlugins:i.FUNNY_PLUGINS,otherPlugins:i.OTHER_PLUGINS},resourceContainerConfig:{image:{needTypeset:true,needDnd:true,needOp:true,addImageEntry:{local:true,album:true,screenCapture:true,meitu:true}}}});t.renderOn(document.getElementById("QM_Mood_Poster_Container"));MOOD.poster=t;t.addListener("onTemplateMoodPostSuccess",function(e){o.makeFakeFeed(e,t)})
;t.addListener("onPluginPostSuccess",function(e){o.makeFakeFeed(e,t)});t.addListener("onPostSuccess",function(e){o.makeFakeFeed(e,t)});try{if(top.location.href.indexOf("auto_show_funny")>-1){t.onReady(function(){this.getUpupPoster(function(e){e.show();e.onFlashReady(function(){this.setInitialContent("")});this.hide()})});n.pv("taotaoact.qzone.qq.com","/mood_poster/auto_show_funny");return}if(top.location.href.indexOf("poster=emoticon/avatar")>-1){t.onReady(function(){t.getMoodEditor().initPlugins();t.getMoodEditor().getFuncAttachBar(function(e){if(e){e.callByPath("tabItems.emoticon.tabButton.onClick")}})});n.pv("taotaoact.qzone.qq.com","/mood_poster/auto_show_avatar");return}if(top.location.href.indexOf("auto_show_bubble")>-1){t.onReady(function(){t.callByPath("moodEditor.loadPlugins",{template:{version:"2.0",enable:true}},{onSuccess:function(){this.fireEvent("TEMPLATE_BTN_CLICKED")}})});n.pv("taotaoact.qzone.qq.com","/mood_poster/auto_show_bubble")}
if(top.location.href.indexOf("auto_show_qutu")>-1){t.onReady(function(){t.callByPath("moodEditor.loadPlugins",{qutu:{version:"1.0",enable:true}},{onSuccess:function(){var e=this;e.addEvent("MOOD_POSTER_QUTU_PLUGIN_READY",function(){e.fireEvent("QUTU_BTN_CLICKED")})}})});n.pv("taotaoact.qzone.qq.com","/mood_poster/auto_show_qutu")}if(top.location.href.indexOf("auto_show_flash_img")>-1){t.onReady(function(){t.callByPath("moodEditor.loadPlugins",{flare_font:{version:"1.0",enable:true}},{onSuccess:function(){var e=this;e.addEvent("MOOD_POSTER_FLARE_FONT_PLUGIN_READY",function(){e.fireEvent("FLARE_FONT_BTN_CLICKED")})}})})}}catch(e){n.pv("taotaoact.qzone.qq.com","/mood_poster/auto_show_error")}qzlog.info({cm:"MOOD_APP",cf:"init MoodPoster FINISHED"})})})}};MOOD.lastComment={itemElement:null,getItemElement:function(e){var t=QZFL.event.getTarget(e);var o=null;QZFL.dom.searchChain(t,"parentNode",function(e){if(e==window.document){return false}
if(QZFL.css.hasClassName(e,"comment_feed")&&e.tagName=="LI"){o=e;return true}});this.itemElement=o;return o},getMoodData:function(e){var t=this.getItemElement(e);var o=$e(t).getAttr("tid");var n=MOOD.DataStorage.get(o);return n&&n.data},dataMap:function(e){var o=t.l.msglist;for(var n=0;n<o.length;n++){var i=o[n];if(i.tid==e){return i}}},popup:function(mood,type){var here=this;var cpn_src=["http://"+siDomain+"/qzone/app/mood_v6/plugin/CRPopupModel.js","http://"+siDomain+"/qzone/app/jSolution/jSolution_1.0_qzone.js"];with(QZONE.FP._t){QZFL.imports(cpn_src,function(){var e=new CRPopupModel({type:type,item:{uin:mood.uin,tid:mood.tid},onPosted:function(e){here.countAll(e)}})})}},popupComment:function(e){var t=this.getMoodData(e);this.popup(t,1);MOOD.sendEvent("popup_newest_comment")},popupRetweet:function(e){var t=this.getMoodData(e);this.popup(t,2);MOOD.sendEvent("popup_newest_retweet")},countOne:function(e){var t=$e(this.itemElement);var o=t.find("."+e+"_num");var n=parseInt(o.getHtml())
;o.setHtml(++n)},countAll:function(e){var t=this;for(var o=0;o<e.length;o++){t.countOne(e[o])}}};(function(){MOOD.mapTips={show:function(t,o,n){if(e.popupId){e.hide()}var i=['<iframe id="checkinframe" src="http://',QZONE.FP._t.imgcacheDomain,"/qzone/app/controls/map/tips.html#posx=",o,"&posy=",n,'" allowtransparency frameborder="0" scrolling="no" style="width:300px;height:200px;"></iframe>'].join("");var a={timeout:-1,backgroundColor:!QZONE.FP._t.g_OFPLite?"#FFFDF4":"#F5F6F6",contentPadding:1,noQueue:true,id:"TipsPopup",arrowPoint:1,arrowEdge:1,closeButtonSize:14,closeButtonColor:"red",width:302,height:202,x:-14,y:3};var r=QZFL.dom.getXY(frameElement.parentNode);var s=QZFL.dom.getXY(t);var c=QZONE.FP._t.QZFL.dom.getClientHeight();if(r[1]+s[1]+220>c+QZONE.FP.getScrollTop()){a.arrowPoint=4;a.arrowEdge=3}e.popupId=QZFL.widget.tips.show(i,t,a);setTimeout(function(){QZFL.event.addEvent(document.body,"click",e.hide)},100)},hide:function(){var t=QZFL.widget.tips.instances[e.popupId]
;QZFL.widget.tips.close(t);QZFL.event.removeEvent(document.body,"click",e.hide);e.popupId=null}};var e=MOOD.mapTips})();QZFL.object.extend(MOOD.util,{Forward:function(e){QZFL.imports("http://"+siDomain+"/qzone/app/controls/forwardingBox/forwardingBoxFacade.js",function(){QZONE.ICFeeds.App.ForwardingBox.bootstrap("",e);MOOD.sendEvent("retweet")},{charset:"utf-8"})}});MOOD.getStatPackage=function(){return window.QZONE&&window.QZONE.FP&&window.QZONE.FP.getStatPackage?QZONE.FP.getStatPackage():top.QZONE.FP.getStatPackage()};MOOD.sendPV=function(e){if(e){setTimeout(function(){var t="taotao.qzone.qq.com";var o=e;if(document.domain=="pengyou.com"){t="xiaoyou.qq.com";switch(e){case"title":o="index/twitterv2.php";break;case"mytitle":o="index/twitterv2.php";if(QZONE.PY&&QZONE.PY.hasLeftBar){if(QZONE.PY.hasLeftBar()){o="index/twitterv2/tab.php"}}break;case"guesttitle":o="index/twitterv2/tab.php";break;case"detail":o="index/twitterv2/detail.php";break;case"setting":o="index/twitterv2/setting.php"
;break;default:o=e}}var n=MOOD.getStatPackage();n.pv(t,"/"+o)},0)}};MOOD.TCISDClick=function(e,t,o){t=t||"/";o=o||"taotaoact.qzone.qq.com";window.console&&console.log("TCISD:",e,t,o);try{QZONE.FP._t.TCISD.hotClick(e,o,t)}catch(e){}};MOOD.TCISDClick.batchBind=function(e,t){t=QZFL.object.extend({eventType:"mousedown",url:null,domain:null,container:document},t||{});var o={};QZFL.each(e,function(e,n){o[n]=function(){MOOD.TCISDClick(e,t.url,t.domain)}});MOOD.batchDelegate(o,t.container,t.eventType,true)};MOOD.batchDelegate=function(){var e=function(e){return e&&e.tagName=="A"&&(e.href||"").indexOf("http://")==0};var t=function(e,t){var o;$e(t).each(function(t){if(!o&&(t==e||QZFL.dom.isAncestor(t,e))){o=t;return false}});return o};return function(o,n,i,a){i=i||"click";n=n||document;QZFL.each(o,function(o,r){QZFL.event.delegate(n,r,i,function(n){var s=QZFL.event.getButton(n);var c=QZFL.event.getTarget(n);c=t(c,r);if(c){if(i=="click"&&s!=0&&e(c)){}else{o(c);if(c.tagName=="A"&&!a){
QZFL.event.preventDefault(n)}}}})})}}();MOOD.sendEvent=function(e){if(e){e=e+"/v"+MOOD.version;setTimeout(function(){var t=MOOD.getStatPackage();t.pv("taotaoact.qzone.qq.com","/"+e)},0)}};MOOD.sendHotClick=function(e){if(e){setTimeout(function(){var t=MOOD.getStatPackage();t.hotClick(e,"taotaoact.qzone.qq.com")},0)}};MOOD.pageStart=function(e){e();MOOD.event.init()};var mood=mood||{};mood.jumpPage=MOOD.jumpPage=function(e,t){MOOD.sendEvent("clickname");MOOD.util.goProfile(e,t)};MOOD.jumpToAudit=function(){window.open("http://user.qzone.qq.com/"+QZONE.FP.getQzoneConfig("loginUin")+"/mood/jumpToAudit","_blank")};MOOD.resizeImage=function(e,t,o){if(e.loaded==true)return;e.loaded=true;var n=new Image;n.onload=function(){if(n.width>t){e.width=t;e.style.width=t+"px";e.style.height="auto"}else{e.width=n.width;e.style.width=n.width+"px";e.style.height="auto"}e.style.display="block"};n.src=e.src};MOOD.Music=MOOD.Music||{};MOOD.Music.getAlbumImage=function(e){e=e||0;if(e>0){
return["//edu.qzs.qq.com/music/photo/album/",e%100,"/150_albumpic_",e,"_0.jpg"].join("")}return"//music.qq.com/musicbox/img/uccpic_error.jpg"};MOOD.Setting=function(e,o,n,i){var a=["sign_sync_ss","ss_sync_sign","ss_sync_tweet","ss_sync_share","sync_view"];var r={},s,c;for(s=0;s<a.length;s++){c=a[s];r[c]=e[c]}r[o]=n;r["hostuin"]=t.uin;var l=MOOD.domain.getUrl("signset");var u=new QZFL.FormSender(l,"post",r,"utf-8");u.onSuccess=function(e){MOOD.sendEvent("setting_submit_success");QZONE.FP.showMsgbox("设置成功",4,2e3);if(i){i()}};u.onError=function(e){MOOD.sendEvent("setting_submit_faild");QZONE.FP.showMsgbox("服务器忙，请稍后重试。")};u.send()};(function(e){"use strict";var t={};var o=function(e,o,n){var i="o"+e;if(o){i=i+"_"+o}return t[i]=n};var n=function(e,o){e=e||"";var n="o"+e;if(o){n=n+"_"+o}if(t[n]=="string"){return t[n]}else{a(e)}return"taotao.qq.com"};var i=function(e,t){e=e||{};e.result=e.result||{};var n="taotao.qq.com";if(e.result.code==0){if(e.idcNo==1){n="taotao.qq.com"
}else if(e.idcNo==2){n="sh.taotao.qq.com"}}else{e={idcNo:1,result:{code:0},uin:t}}e.uin=e.uin||t;window.locationCache=window.locationCache||[];window.locationCache.push(e);o(t,"",n)};var a=function(e){};var r=function(t,o,n){var t=e.util.getHttpParams("uin")||QZONE.FP.getQzoneConfig("ownerUin");i(window._locationCache||{},t)};e.domain={load:r,get:n}})(MOOD=MOOD||{});(function(){"use strict";var e={index:["emotion_cgi_get_mix_v6",0],msglist:["emotion_cgi_msglist_v6",1],timer:["emotion_cgi_timershuoshuolist_v6",0],del_timer:["emotion_cgi_del_timershuoshuo_v6",0],pubnow_timer:["emotion_cgi_pubnow_timershuoshuo_v6",0],del:["emotion_cgi_delete_v6",0],comment:["emotion_cgi_comment_v6",0],delcomment:["emotion_cgi_delcomment_v6",0],reply:["emotion_cgi_addreply_v6",0],delreply:["emotion_cgi_delreply_v6",0],forward:["emotion_cgi_forward_v6",0],signset:["emotion_cgi_signset_v6",0],setting:["emotion_cgi_setting_v6",0],mutireplies:["emotion_cgi_mutireplies_v6",0],
multitopcomments:["emotion_cgi_multitopcomments_v6",0],addtopcomment:["emotion_cgi_addtopcomment_v6",0],getcomments:["emotion_cgi_getcomments_v6",0],get_pics:["emotion_cgi_get_pics_v6",0]};MOOD.domain.getUrl=function(t,o){var n=e[t];var i="taotao.qq.com";if(n[1]){i=MOOD.domain.get(o)}return"http://"+i+"/cgi-bin/"+n[0]}})();(function(){function e(e){var t=null;QZFL.dom.searchChain(e,"parentNode",function(e){if(e==window.document){return false}if(QZFL.css.hasClassName(e,"feed")&&e.tagName=="LI"){t=e;return true}});return t}function t(e){var t=null;QZFL.dom.searchChain(e,"parentNode",function(e){if(e==window.document){return false}if(QZFL.css.hasClassName(e,"qz_shuoshuo_audio")&&e.tagName=="DIV"){t=e;return true}});return t}MOOD.MsgList=function(e){var t=this;QZFL.object.extend(t,{extUrl:"https://"+QZONE.FP._t.siDomain+"/qzone/app/mood_v6/script/msgListExt.js?max_age=600&r="+MOOD.version,callExt:MOOD.interface.callExt,container:""},e);t.el=$e($(t.container));t.clickProxy();t.mouseProxy()}
;MOOD.MsgList.prototype={clickProxy:function(){var o=this;var n=false;o.el.bind("click",function(n){if($j){var i=$j(n.target);if(i.hasClass("goDetail")){top.window.g_point0_311=(new Date).getTime()}var a={allCount:i.data("v_living_allcount"),duration:i.data("v_living_duration"),initType:i.data("v_living_type"),likeNum:i.data("v_living_likenum"),owner:i.data("v_living_uin"),roomId:i.data("v_living_roomid"),type:i.data("v_living_type"),url:i.data("v_living_url"),viewerNum:i.data("v_living_viewernum")};var r=n.target||n.srcElement;if(r.hasAttribute("data-v_living_roomid")){seajs.use("v8/ic/popup_live",function(e){e&&e.openLiveInLiveViewer({roomId:a&&a.roomId,onClose:function(){},from:"videoManager"})});return}}var s=QZFL.event.getTarget(n);var c=e(s);var l=$e(c).getAttr("data-tid");var u=MOOD.DataStorage.get(l);if(!u){return}var d=false;QZFL.dom.searchChain(s,"parentNode",function(e){if(e==window.document){return false}if(d){return true}
if((s.tagName=="IMG"||s.tagName=="A")&&QZFL.css.hasClassName(e,"smallPic")){if(u.data.lucky_money&&u.data.lucky_money.action_url){window.open(u.data.lucky_money.action_url)}else if(u.data.timershuoshuo||document.domain=="pengyou.com"){o.callExt("showBigPic",[u,c])}else{o.callExt("showSlideView",[u,s])}d=true;return true}if(QZFL.css.hasClassName(e,"see-all")){if(u.data.appid==202){return true}o.callExt("showBigPic",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"passwrod_required")){o.callExt("passwrodRequired",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"apply_access")){o.callExt("applyAccess",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"edit_btn")){QZONE.FP.showMsgbox("加载中...",6,5e3);o.callExt("edit",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"viewmap")){o.callExt("viewMap",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"js_play_record")){var i=t(s);o.callExt("playRecord",[u,c,i]);d=true;return true}
if(s.tagName=="A"&&QZFL.css.hasClassName(e,"timer_del")){o.callExt("timer_del",[u,c]);d=true;return true}if(s.tagName=="A"&&QZFL.css.hasClassName(e,"del")){o.callExt("del",[u,c]);d=true;return true}if(s.tagName=="A"&&QZFL.css.hasClassName(e,"timer_send_now")){o.callExt("timer_send_now",[u,c]);d=true;return true}if(s.tagName=="A"&&QZFL.css.hasClassName(e,"forward_btn")){o.callExt("showForward",[u,s]);d=true;return true}if(s.tagName=="A"&&QZFL.css.hasClassName(e,"comment_btn")){controller.initCommentModule(u.data,function(e){if(e.isCommentBoxVisible())return;e.show();e.focus()});d=true;return true}if(s.tagName=="A"&&QZFL.css.hasClassName(e,"qz_like_btn")){d=true;return true}if(s.tagName=="A"&&QZFL.css.hasClassName(e,"rt_forward_btn")){o.callExt("rtShowForward",[u,c]);d=true;return true}if(s.tagName=="A"&&QZFL.css.hasClassName(e,"rt_comment_btn")){o.callExt("rtShowComment",[u,c]);d=true;return true}if(s.tagName=="A"&&QZFL.css.hasClassName(e,"report")){o.callExt("report",[u,c]);d=true}
if(QZFL.css.hasClassName(e,"smallVideo")){o.callExt("playVideo",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"js_play_audio")){o.callExt("playAudio",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"js_hide_audio")){o.callExt("stopAudio",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"goDetail")){QZFL.event.preventDefault(n);o.callExt("goDetail",[u,c,e]);d=true;return false}if(QZFL.css.hasClassName(e,"smallVote")){o.callExt("showVote",[u,c,s]);d=true;return true}if(QZFL.css.hasClassName(e,"smallAttach")){o.callExt("showAttach",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"js_collapse")){QZFL.event.preventDefault();o.callExt("collapse",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"to_public")){o.callExt("toPublic",[u,c]);d=true;return true}if(QZFL.css.hasClassName(e,"has_more_con")){var a=QZFL.css.hasClassName(e,"more_active");o.callExt("showMoreContent",[u,c,1,a]);d=true;return true}if(QZFL.css.hasClassName(e,"rt_has_more_con")){
var a=QZFL.css.hasClassName(e,"more_active");o.callExt("showMoreContent",[u,c,2,a]);d=true;return true}});if(d){QZFL.event.preventDefault();return false}});function i(e,t,o){var n=$("msgList");QZFL.event.delegate(n,e,"mouseenter",function(e){if(typeof t=="function"){t.call(this,e,this)}});QZFL.event.delegate(n,e,"mouseleave",function(e){if(typeof o=="function"){o.call(this,e,this)}})}i(".qz_shuoshuo_audio",function(e,t){QZFL.css.addClassName(t,"bor_bg6");QZFL.css.removeClassName(t,"bor2")},function(e,t){QZFL.css.addClassName(t,"bor2");QZFL.css.removeClassName(t,"bor_bg6")})},mouseProxy:function(){var e=this.el.elements[0];seajs.use(["jquery","migrate-plugin"],function(t,o){t(e).on("mouseenter",".feed",function(e){t(e.currentTarget).addClass("feed_hover").find(".mouseOver").show()}).on("mouseleave",".feed",function(e){t(e.currentTarget).removeClass("feed_hover").find(".mouseOver").hide()});t(document).on("mouseenter",".more-edit-items",function(e){
t(e.currentTarget).addClass("dropdown-open")}).on("mouseleave",".more-edit-items",function(e){t(e.currentTarget).removeClass("dropdown-open")});t(document).on("click","a[role=menuitem]",function(){t(".more-edit-items").removeClass("dropdown-open")});t(document).on("mouseenter","a[role=menuitem]",function(e){t(e.currentTarget).addClass("bg2")}).on("mouseleave","a[role=menuitem]",function(e){t(e.currentTarget).removeClass("bg2")})})}}})();(function(){var e=2096;var t=function(t){var o=function(){};this.config={IMG_LINK_TPL:'<a href="{link}" bosstrace="{bosstrace}" target="{target}" ><img src="{img}" bosstrace="{bosstrace}" url="{link}" alt="qboss_ad_image" /></a>',img_pid:"",img_container:null,img_close_btn:null,img_onload:o,img_onclose:o,text_pid:"",text_container:null,text_onload:o,board_id:e,support_multi:false};t=t||{};QZFL.object.extend(this.config,t)};t.prototype.addImgOnLoadListener=function(e){if(typeof e=="function"){this.config.img_onload=e}}
;t.prototype.addTextOnLoadListener=function(e){if(typeof e=="function"){this.config.text_onload=e}};t.prototype.show=function(){var e=this;var t=function(t){if(!e.config.img_container){return}var o=e.config.IMG_LINK_TPL;var n=0,i,a=t||[];if(a.length>0){n=Math.floor(Math.random()*a.length);a[n].objExtData=new Function("return "+a[n].extdata)();a[n].objExtData.bosstrace=a[n].bosstrace;a[n].objExtData.target=a[n].objExtData.link.indexOf("javascript")!=-1?"":"_blank";e.config.img_container.innerHTML=format(o,a[n].objExtData);var r=$e(e.config.img_close_btn);r.onClick(function(){if(e.switchTimer){clearInterval(e.switchTimer);e.switchTimer=null}e.config.img_container.innerHTML="";r.hide();var t=[];for(var o=0,n=a.length;o<n;o++){t.push(a[o].bosstrace)}var i=new Image;i.src="http://boss.qzone.qq.com/fcg-bin/fcg_rep_multiple_strategy?from=1&uin="+QZONE.FP.getQzoneConfig("loginUin")+"&qboper=3&bosstrace="+encodeURIComponent(t.join(","));e.config.img_onclose()});r.show()}
if(a.length>1&&e.config.support_multi){var s=[];for(var c=0;c<a.length;c++){s.push("<span>&#9679;</span>");a[c].objExtData=new Function("return "+a[c].extdata)();a[c].objExtData.bosstrace=a[c].bosstrace}s.push('<div class="mask"></div>');$e(".pop_apps_wrap div.switcher").setHtml(s.join(""));function l(){$e(".pop_apps_wrap div.switcher span").each(function(e,t){if(t==n){$e(e).addClass("current")}else{$e(e).removeClass("current")}})}l();e.switchTimer=setInterval(function(){n++;if(n>a.length-1){n=0}e.config.img_container.innerHTML=format(o,a[n].objExtData);l()},5e3)}else{$e(".pop_apps_wrap div.switcher").setHtml("")}e.config.img_onload()};var o=this.config.board_id;var n={uin:QZONE.FP.getQzoneConfig("loginUin"),board_id:o};var i="http://boss.qzone.qq.com/fcg-bin/fcg_get_strategy";var a=new QZFL.JSONGetter(i,null,n,"utf-8");a.onSuccess=function(e){e=e||{};if(e.code==0&&e.data[o]&&e.data[o].items.length>0){var n=e.data[o].items;t(n)}};a.send("_Callback")};window.Sponsors=t
;var o=function(e){var t=QZFL.event.getTarget(e);if(t){var o=t.getAttribute("bosstrace")||"";var n=new Image;n.src="http://boss.qzone.qq.com/fcg-bin/fcg_rep_strategy?from=1&uin="+QZONE.FP.getQzoneConfig("loginUin")+"&qboper=2&bosstrace="+o}};var n={img_pid:"qzone_shuoshuo_img_1",img_container:$("qzone_shuoshuo_img_1"),img_close_btn:$("qzone_shuoshuo_close_1"),img_onload:function(){$e("#pop_apps_sponsors").removeClass("none");$e("#pop_apps_split").removeClass("none");$e("#qzone_shuoshuo_img_1").onClick(o)},img_onclose:function(){$e("#pop_apps_sponsors").addClass("none");$e("#pop_apps_split").addClass("none");$e("#qzone_shuoshuo_img_1").unBind("click",o)},text_pid:"qzone_shuoshuo_imgtxt_1",text_container:$("qzone_shuoshuo_imgtxt_1"),text_onload:function(){$e("#pop_apps_sponsors").removeClass("none");$e("#pop_apps_split").removeClass("none")}};var i=new t(n);i.show();var a={
IMG_LINK_TPL:'<a href="{link}" target="{target}"><img src="{img}" bosstrace="{bosstrace}" url="" alt="qboss_ad_image"/></a>',img_container:$("bottom-sponsor-img"),img_close_btn:$("bottom-sponsor-close"),board_id:2199,support_multi:false,img_onload:function(){$e("#bottom-sponsor").removeClass("none");$e("#bottom-sponsor-img").onClick(o)},img_onclose:function(){$e("#bottom-sponsor").addClass("none");$e("#bottom-sponsor-img").unBind("click",o)}};setTimeout(function(){var e=new t(a);e.show()},3e3)})();MOOD.topic={updateCount:function(e,t){t=t||[];var o,n=t.length;var i=[];for(o=0;o<n;o++){i.push(t[o].likekey)}var a="http://"+QZONE.FP._t.g_R_Domain+"/cgi-bin/qzonesoso/cgi_qzonesoso_showlike";var r={uin:QZONE.FP.getQzoneConfig("loginUin"),keys:i.join(","),t:(new Date).getTime()};if(n>0){var s=new QZFL.JSONGetter(a,null,r,"utf-8");s.onSuccess=function(e){var t=e.data||[];if(i.length==t.length){for(var o=0,n;o<t.length;o++){n="#"+i[o];$e(n).setHtml(t[o].count+t[o].liked)}}};s.send("callback")}
},showHot:function(e){var t=this;var o={uin:QZONE.FP.getQzoneConfig("loginUin")};var n="http://r.qzone.qq.com/cgi-bin/qzonesoso/cgi_qzonesoso_hotword";var i=new QZFL.JSONGetter(n,null,o,"utf-8");i.onSuccess=function(o){if(o.ret==0&&o.data&&(o.data.resultdata=o.data.resultdata||[])){var n=tmpl(MOOD.tmp.hotTopic,{items:o.data.resultdata});$e($(e)).setHtml(n);t.updateCount(e,o.data.resultdata)}};i.send("callback");var a={img_pid:"qzone_shuoshuo_img_1",img_container:$("qzone_shuoshuo_img_1"),img_close_btn:$("qzone_shuoshuo_close_1"),img_onload:function(){$e("#pop_apps_sponsors").removeClass("none");$e("#pop_apps_split").removeClass("none")},img_onclose:function(){$e("#pop_apps_sponsors").addClass("none");$e("#pop_apps_split").addClass("none")},text_pid:"qzone_shuoshuo_imgtxt_1",text_container:$("qzone_shuoshuo_imgtxt_1"),text_onload:function(){$e("#pop_apps_sponsors").removeClass("none");$e("#pop_apps_split").removeClass("none")}};var r=new Sponsors(a);r.show()},search:function(e){
var t=document.domain=="qq.com";if(t){QZONE.FP.Search(e,{type:"mood"})}else{var o="http://www.pengyou.com/index.php?mod=twitterv2&act=topic#key="+encodeURI(e);window.open(o)}return false}};function searchHot(e){var t=QZFL.event.getEvent();if(t.keyCode==13){QZONE.FP.sendPV("taotao.qzone.qq.com","search");MOOD.topic.search(e.value)}}$e("#hotkeysearch").onBlur(function(){if(this.value==""){this.value="搜索其他热门话题..."}});$e("#hotkeysearch").onFocus(function(){if(this.value=="搜索其他热门话题..."){this.value=""}});$e("#hotkeysearch").onKeyPress(function(){searchHot(this)});$e("#hotkeysearchbtn").onClick(function(){QZONE.FP.sendPV("taotao.qzone.qq.com","search");MOOD.topic.search($("hotkeysearch").value)});window.MOOD=window.MOOD||{};window.QZONE=window.QZONE||{};QZONE.FP=QZONE.FP||parent.QZONE.FrontPage;parent.QZFL.object.map(parent.QZFL.string,window);parent.QZFL.object.map(parent.QZFL.util,window);parent.QZFL.object.map(parent.QZFL.lang,window);MOOD.tmp=MOOD.tmp||{};MOOD.util=MOOD.util||{}
;QZFL.object.extend(MOOD.util,{initLoader:function(e){var t=e.callbacks;e.onSuccess||(e.onSuccess=function(){for(var e;e=t.shift();){e.apply(null,arguments)}})},loaders:{F4A:function(){var e=arguments.callee;MOOD.util.initLoader(e);if(window.F4A){e.onSuccess();return}QZFL.imports("http://"+parent.siDomain+"/qzone/app/f4a/F4A_1.2.lite.js?max_age=600&ver=20120111",e.onSuccess)},jSolution:function(){var e=arguments.callee;MOOD.util.initLoader(e);if(window.jSolution){e.onSuccess();return}MOOD.util.require("F4A",function(){QZFL.imports("http://"+parent.siDomain+"/qzone/app/jSolution/jSolution_1.0_qzone.js",e.onSuccess)})},attachmentThumbnail:function(){var e=arguments.callee;MOOD.util.initLoader(e);MOOD.util.require("jSolution",function(){jSolution["1.0"].load({resName:"ThumbnailFacade",nsName:"/controls/attachBar",nsVer:"3.0",onSuccess:e.onSuccess})})}},require:function(e,t){var o=MOOD.util.loaders[e];var n=o.callbacks||(o.callbacks=[]);n.push(t);o()},getHttpParams:function(e){
var t=new RegExp("(\\?|#|&)"+e+"=([^&#]*)(&|#|$)");var o=location.href.match(t);return decodeURIComponent(!o?"":o[2]).replace(/\+/g," ")},go:function(e,t){var o="";if(e.match(/^https?/)||e.match(/^\/\//)){o+=e}else{o=location.protocol+"//"+parent.imgcacheDomain;if(!e.match(/^\//)){o+="/qzone/app/mood_v6/html/"}o+=e}if(t){o+="#"+genHttpParamString(t)}try{if(o.indexOf("https://qzs.qq.com")>-1){o=o.replace("https://qzs.qq.com","https://user.qzone.qq.com/proxy/domain/qzs.qq.com");if(o.indexOf("?")>-1){o+="&g_iframeUser=1"}else{o+="?g_iframeUser=1"}}window.location.href=o}catch(e){frameElement.src=o}},HTML:function(e){e=(e||"")+"";var t=/(?:@\{uin:([^\}]*),nick:([^\},]*)(?:,who:(\d+))?\})|[^@]+/g;var o={"%7D":"}","%2C":",","%25":"%"};var n=function(e){if(e){for(var t in o){e=e.replace(t,o[t])}}return e};var i=e.split(/(#(?:.|<br\/>)+?#)/g);var a=0;var r="",s="",c,l,u,d;for(var m=0;m<i.length;m++){s=i[m];u=false;c="";l="";c=s.replace(/#((?:.|<br\/>)+?)#/g,function(e,t,o){u=true;var n=""
;n='<a href="http://rc.qzone.qq.com/qzonesoso/?search='+encodeURIComponent(t)+'" target="_blank">#'+escHTML(t)+"#</a>";return n});if(!u){c="";mentions=s.split(/(@(?!^\{)[\{]uin\:[a-z\d]+\,nick\:[^}]*[\}])/g);for(var f=0;f<mentions.length;f++){mention=mentions[f];d=false;mention=mention.replace(t,function(e,t,o,i){o=n(o);if(t){d=true;return format('@<a title="{uin}" target="_blank" href="http://user.qzone.qq.com/{uin}" class="c_tx">{name}</a>',{uin:t,name:escHTML(o)})}return escHTML(e)});if(!d){mention=mention.replace(/((?:https|ftp|http):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi,'<a href="$1" target="_blank">$1</a>')}l=l+mention}c=l}r=r+c}return QZFL.FP.removeUBB(r)},getContent:function(e,t,o,n,i,a){var r=MOOD.util.getContent;r.tmpFn=r.tmpFn||tmpl(MOOD.tmp.content);return r.tmpFn({items:e,tid:o,uin:n,certified:i,nosafecheck:a||0})||MOOD.util.HTML(t)},parseContent:function(e){e=(e||"")+"";var t=e.split(/(#(?:.|<br\/>)+?#)/g);var o=false;var n="",i=""
;for(var a=0;a<t.length;a++){tag=t[a];o=false;n="";n=tag.replace(/#((?:.|<br\/>)+?)#/g,function(e,t,n){o=true;var i=QZONE.FP.removeUBB(QZONE.FP.replaceIconTag(escHTML(t)));var a='<a href="http://rc.qzone.qq.com/qzonesoso/?search='+encodeURIComponent(t)+'" target="_blank">#'+i+"#</a>";return a});if(!o){n=QZONE.FP.removeUBB(QZONE.FP.replaceIconTag(escHTML(tag)))}i+=n}return i},getRemark:function(e,t){var o;QZONE.FP.getRemarkList(function(e){o=e;$e(".remarkUin").each(function(){var e=$e(this);var t=e.getAttr("uin");if(o[t]){e.setHtml(escHTML(restHTML(o[t])))}})});this.getRemark=function(e,t){if(o&&o[e]){return escHTML(restHTML(o[e]||t||e))}else{return['<span class="remarkUin" uin="',e,'">',escHTML(t||e),"</span>"].join("")}};return this.getRemark(e,t)},applyAccess:function(e){var t="http://"+QZONE.FP._t.g_W_Domain+"/cgi-bin/tfriend/applyentryright.cgi";var o=new QZONE.FormSender(t,"POST",{vUin:QZONE.FP._t.g_iLoginUin,hUin:e,fupdate:1,rd:Math.random()},"utf-8");o.onSuccess=function(e){
if(e.ret=="succ"||e.code==0){QZONE.FP.showMsgbox('申请已发送，请注意查看“好友消息通知"',4,2e3)}else{QZONE.FP.showMsgbox(e.msg||e.message,1,2e3)}};o.onError=function(){QZONE.FP.showMsgbox("很抱歉，当前使用的人数过多，请休息一会儿再来",1,2e3)};o.send()}});(function(e){var t={};var o=function e(o,n){var i=!/\W/.test(o)?t[o]=t[o]||e(document.getElementById(o).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};"+"with(obj){p.push('"+o.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');");return n?i(n):i};e.tmpl=o})(window);(function(){var e;if(!e){e=function(t,o,n){if(Object.prototype.toString.call(o)!=="[object RegExp]"){return e._nativeSplit.call(t,o,n)}var i=[],a=0,r=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.sticky?"y":""),o=RegExp(o.source,r+"g"),s,c,l,u;t=t+"";if(!e._compliantExecNpcg){s=RegExp("^"+o.source+"$(?!\\s)",r)}
if(n===undefined||+n<0){n=Infinity}else{n=Math.floor(+n);if(!n){return[]}}while(c=o.exec(t)){l=c.index+c[0].length;if(l>a){i.push(t.slice(a,c.index));if(!e._compliantExecNpcg&&c.length>1){c[0].replace(s,function(){for(var e=1;e<arguments.length-2;e++){if(arguments[e]===undefined){c[e]=undefined}}})}if(c.length>1&&c.index<t.length){Array.prototype.push.apply(i,c.slice(1))}u=c[0].length;a=l;if(i.length>=n){break}}if(o.lastIndex===c.index){o.lastIndex++}}if(a===t.length){if(u||!o.test("")){i.push("")}}else{i.push(t.slice(a))}return i.length>n?i.slice(0,n):i};e._compliantExecNpcg=/()??/.exec("")[1]===undefined;e._nativeSplit=String.prototype.split}String.prototype.split=function(t,o){return e(this,t,o)}})();var resizeImage=function(e,t,o){if(e.loaded==true)return;e.loaded=true;var n=new Image;n.onload=function(){if(n.width>t){e.width=t;e.style.width=t+"px";e.style.height="auto"}else{e.width=n.width;e.style.width=n.width+"px";e.style.height="auto"}e.style.display="block"}
;console.log("resizeImage",this);n.src=e.src};var resizeImageHandler=function(){var e=this;var t=this.getAttribute("data-src");var o=this.getAttribute("data-limit")||"";var n=o.split(",");var i=this.width;var a=this.height;if(n.length==2){var r=parseInt(n[0],10);var s=parseInt(n[1],10);var c=new Image;c.onload=function(){var t=this.width/this.height;var o=r/s;if(this.width>r&&this.height>s){if(t<=o){e.width=r}else{e.height=s}}e.style.display="block";c.onload=null};c.src=t}};(function(){window.controller={tab:MOOD.env.tab,uin:MOOD.env.uin,login_uin:""+QZONE.FP.getQzoneConfig("loginUin"),login_name:""+QZONE.FP.getQzoneConfig("loginUin"),updateLoginInfo:function(e){console.log("updateLoginInfo",e);if(e&&typeof e.logininfo=="object"){this.login_name=e.logininfo.name;this.login_uin=e.logininfo.uin}},getTitle:function(){return""},updateTitle:function(e){if(e&&e.usrinfo&&e.usrinfo.uin!=QZONE.FP.getQzoneConfig("loginUin")){var t=escHTML(e.usrinfo.name)+"的说说"
;$e(".mod_tab .friend_feed_head").setHtml(t).show()}},getDetailSuc:function(t){if(t.code<0){return{code:t.code,msg:t.message}}var o={};o.source_name=(t.source_name=="朋友网"||t.source_name=="QQ空间")&&!isQzone?"":t.source_name;o.rt_source_name=(t.rt_source_name=="朋友网"||t.rt_source_name=="QQ空间")&&!isQzone?"":t.rt_source_name||"";o.auth_flag=t.auth_flag||0;o.right=t.right||1;o.commentlist=t.commentlist||[];o.replies=t.replies||t.msgTotal||o.commentlist.length;o.total=1;o.msglist=[t];e.updateTitle(t);return o},getProfileHtml:function(){var e=window._preloadCache;if(e&&e.usrinfo){e.usrinfo.msgnum=e.usrinfo.msgnum||0;return tmpl(MOOD.tmp.profile)(e.usrinfo)}else{return""}},getLastCommentHtml:function(){}};var e=controller})();var t=t||controller;controller.image_displayDetail=function(e){var t=e.comment.getTopic();QZONE.FP.openViewer({appid:311,from:"shuoshuo",ownerUin:t.getHostUin(),topicId:t.getId()+"_1",picKey:t.getId().split("_")[1]+","+e.id,pre:e.url,timeStamp:new Date})}
;QZFL.object.extend(controller,{commentModuleConfig:{commentListConfig:{pageSize:5,showPaginationForm:false,showAllLinkConfig:{innerTemplate:'查看全部<span id="${id}_totalNumLabel"></span>条评论',urlTemplate:function(e){var t="";if(e.getPlatform){t=e.getPlatform()}if(e){if(document.domain=="qq.com"){return"http://user.qzone.qq.com/"+e.getByPath("poster.id")+"/mood/"+e.getId()+"."+t}return"http://baseapp.pengyou.com/"+e.getByPath("poster.id")+"/mood/"+e.getId()+"."+t}return""},onClick:function(e){var o=e.topic;if(t.tab=="detail"){o.setByPath("comments.pageNum",1);return false}var n="//qzs.qq.com/qzone/app/mood_v6/html/index.html?uin="+o.getByPath("poster.id")+"&tid="+o.getId().split("_").pop()+"&need_cmt=1&source="+o.getByPath("platform")||0;if(location.href.indexOf("g_iframeUser=1")>-1){n=n.replace("//qzs.qq.com","//user.qzone.qq.com/proxy/domain/qzs.qq.com");n=n.replace("user.qzone.qq.com",location.host);if(n.indexOf("g_iframeUser=1")==-1){n+="&g_iframeUser=1"}}location.href=n;return false}
},showRepliesByDefault:true,itemConfig:{imageIconConfig:{},imageButtonConfig:{},userLinkConfig:{target:"_self",urlTemplate:function(e){if(e){switch(e.getPlatform()){case e.PLATFORM.PENGYOU:return"http://baseapp.pengyou.com/"+e.getId()+"/mood/";case e.PLATFORM.QZONE:return"http://user.qzone.qq.com/"+e.getId()+"/mood/"}}return"#"},onClick:function(e){var t=e.user;mood.jumpPage(t.getId(),t.getPlatform());return false}},topicLinkConfig:{template:function(e,t){if(e&&t){return['<a href="javascript:void(0);" onclick="MOOD.topic.search(unescape(\'',escape(t),'\'));return false;" class="c_tx">',escHTML(e),"</a>"].join("")}return""}}}},commentBoxConfig:{contentMaxLength:500,emoticonSupported:true,presentTargetUin:0,checkBoxConfig:[],needPrivateComment:1},appid:311},updateFeeds:function(e){if(QZFL.lang.isArray(e)){QZFL.each(e,function(e){t.updateFeed(e)})}else{t.updateFeed(e)}},updateFeed:function(e){var o="mood_"+e.tid;if(!MOOD.DataStorage.get(e.tid)){QZFL.console.print("updateFeed: "+o)
;e.created_time=(new Date).valueOf();e.source_name=(e.source_name=="朋友网"||e.source_name=="QQ空间")&&!isQzone?"":e.source_name;e.rt_source_name=(e.rt_source_name=="朋友网"||e.rt_source_name=="QQ空间")&&!isQzone?"":e.rt_source_name;var n=MOOD.DataStorage.set(e.tid,e);var i=document.createElement("div");i.innerHTML=n.getItemHTML();var a=$e(i).find("li").elements[0];var r=$("msgList");if(r.childNodes[0]){r.insertBefore(a,r.childNodes[0])}else{r.appendChild(a)}t.initCommentModule(e);t.loadVisiableItems();try{var s=$e(".feed_num a").getHtml();s=parseInt(s,10);s++;$e(".feed_num a").setHtml(s);$e(".empty_pic_message").hide()}catch(e){}}else{QZFL.console.print(o+" existed.")}},renderLikeButton:function(e){$e(".mod_feed_lst#msgList li.feed").each(function(){var e=this.getAttribute("data-tid");var o=MOOD.DataStorage.get(e);if(o){t.likeButton(o)}})},likeButton:function(e){var t=$("like_btn_"+e.data.tid);if(t){if(t.getAttribute("data-handled")==1){return}(function(e,t){var o=e;var n=o.data;var i=""
;var a="";var r=n.pictotal==1?true:false;if(r){var s=n.pic[0].unilikekey;var c=n.pic[0].curlikekey}if(n.rt_tid&&n.rt_nosrc){i=["http://user.qzone.qq.com/119/mood/",n.rt_tid,".",n.rt_source].join("");a=["http://user.qzone.qq.com/",n.uin,"/mood/",n.tid,".",n.t1_source].join("")}else if(n.rt_tid){i=["http://user.qzone.qq.com/",n.rt_uin,"/mood/",n.rt_tid,".",n.rt_source].join("");a=["http://user.qzone.qq.com/",n.uin,"/mood/",n.tid,".",n.t1_source].join("")}else if(r&&(s||c)){i=s||c;a=c||s}else{i=["http://user.qzone.qq.com/",n.uin,"/mood/",n.tid,".",n.t1_source].join("");a=i}var l={key:["http://user.qzone.qq.com/",n.owneruin||n.uin,"/mood/",n.tid].join(""),uniKey:i,curKey:a};var l=o.getLikeKeys();QZONE.FP.addUGCLike(t,{uniKey:l.uniKey,curKey:l.curKey},{btnStyle:3,template:{keepInSameRow:true,refreshTipBack:function(e,t){if(!document){return}var o=document.getElementById("feed_like_"+n.tid);if(o){if(t){o.innerHTML=t;o.style.display=""}else{o.style.display="none"}}},
TIP:['<span><i class="ui_ico icon_hand ui_ico_f qz_like_hand hand"></i>','<?if {ilike}>"0"?>我<?/if?>','<?if {ilike}>"0"?><? cif{rCnt}>"0"?>和<?/cif?><?/if?>','<?loop times="2" ?><a href="http://user.qzone.qq.com/{uin}" target="_blank" class="c_tx" title="{nick}">{shortNick}</a><?if {count}<{length}?>、<?/if?>&nbsp;<?/loop?>',"{etc}",'<?if {rCnt}>"0"?>','<a href="javascript:void(0);" onclick="QZONE.FP.getLikeList(\'',i,"');MOOD.sendEvent('clickLikePeopleNum');return false;\" class=\"c_tx\">","{peopleCount}</a>","<?/if?>",'<?if {cnt}>"0"?>觉得很赞<?/if?>',"</span>"].join("")},onLike:function(){try{MOOD.sendEvent("like"+location.pathname)}catch(e){}},onCancelLike:function(){try{MOOD.sendEvent("unlike"+location.pathname)}catch(e){}}})})(e,t);t.setAttribute("data-handled",1)}},isAbleTo:function(e,t){var o=t.getByPath("poster.uin");var n=QZONE.FP.getQzoneConfig("loginUin");var i=t.getByPath("topic.poster.id");if(e=="reportComment"){return o!=n}if(e=="reportReply"){return false}
if(e=="removeComment"){if(i==n){return true}if(o==n){return true}return false}if(e=="removeReply"){if(i==n){return true}if(o==n){return true}return false}if(e=="postReply"){return true}return false},isAbleTo4Share:function(e,o){if(e=="reportComment"||e=="reportReply"){return false}return t.isAbleTo(e,o)},extendCommentSync:function(e){if(e.ugc_right>=4){return[]}var t=[{checkBoxChecked:0,checkBoxLabel:"同时转发",checkBoxLocalKey:"with_fwd",showCheckBox:1}];if((e.to_tweet||e.wbid)&&QZONE.FP.getUserBitmap(41)&&QZONE.FP.getLoginBitmap(41)){t.push({checkBoxChecked:0,checkBoxLabel:"点评到微博",checkBoxLocalKey:"to_tweet",showCheckBox:1})}return t},adaptMoodCommentData:function(e){var t={};var o=[];var n;for(var i=0;i<e.length;i++){var t=e[i];n=[];if(t.list_3){for(var a=0;a<t.list_3.length;a++){var r=t.list_3[a];n.push({id:r.tid,content:r.content,pic:r.pic,poster:{id:r.uin,name:r.name,platform:r.t3_source},postTime:r.create_time})}}o.push({id:t.tid,content:t.content,poster:{id:t.uin,name:t.name,
platform:t.t2_source},pic:t.pic,postTime:t.create_time,replies:n,source:"",private:t["private"],targetImage:t.targetImage})}return o},initCommentModule:function(e,o){var n=e;MOOD.commentModule=MOOD.commentModule||{};var i=MOOD.commentModule[n.tid];if(i){o&&o(i);return}if(n.timershuoshuo){return}n.auth_flag=n.auth_flag||0;n.source_name=n.source_name&&(n.source_name=="朋友网"||n.source_name=="QQ空间")&&!isQzone?"":n.source_name;n.rt_source_name=n.rt_source_name&&(n.rt_source_name=="朋友网"||n.rt_source_name=="QQ空间")&&!isQzone?"":n.rt_source_name;n.commentTotal=n.replies;var a=controller.commentModuleConfig.commentListConfig.itemConfig;if(controller.tab=="detail"){a.imageIconConfig.onClick=null;a.imageButtonConfig.onClick=controller.image_displayDetail}else{a.imageIconConfig.onClick=controller.image_displayDetail;a.imageButtonConfig.onClick=null}if(controller.tab=="detail"){controller.commentModuleConfig.commentListConfig.pageSize=20
;controller.commentModuleConfig.commentListConfig.defaultPageNum=1}else{controller.commentModuleConfig.commentListConfig.pageSize=5;controller.commentModuleConfig.commentListConfig.defaultPageNum=0}if(n.source_type=="share"){requirejSolution(function(e){e.load({ids:["/controls/commentModule:3.0:prototype","/controls/commentModule/viewModel:3.0_common:prototype","/requests/base:3.0:prototype"],onSuccess:function(e,i,a){MOOD.commentModule[n.tid]=e.create({config:controller.commentModuleConfig,dataContext:i.create({id:n.uin+"_"+n.tid,hostUin:QZONE.FP.getQzoneConfig("ownerUin"),poster:i.UserViewModel.create({id:n.uin,name:n.name}),cgiUrls:{postReply:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshareaddcomment?fupdate=2",postComment:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshareaddcomment?fupdate=2",removeComment:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzsharedeletecomment?fupdate=2",loadComments:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshareget_comment?fupdate=2"},
strategy:{isAbleTo:t.isAbleTo4Share},request:a.create({get_onReceived:function(e){if(e.code!==0){e.code=0;e.message="";e.data={comments:[]}}else{if(e.data.total){$("comment_btn_"+n.tid).innerHTML="评论("+e.data.total+")"}}}}),inCharset:"utf-8",outCharset:"utf-8"}),placeHolder:$("comment_list_"+n.tid)});o&&o(MOOD.commentModule[n.tid])}})});return}requirejSolution(function(e){e.load({ids:["/controls/commentModule:3.0:prototype","/controls/commentModule/viewModel:3.0_common:prototype","/requests/moodRequest:3.1:prototype","/strategies/moodRequestStrategy:3.1:prototype"],onSuccess:function(e,i,a,r){var s=window._locationCache||{idcNo:1};var c=s.idcNo==2?"sh.":"";var l="http://taotao.";if(location.href.indexOf("g_iframeUser=1")>-1){l="https://user.qzone.qq.com/proxy/domain/taotao."}var u={id:n.uin+"_"+n.tid,hostUin:QZONE.FP.getQzoneConfig("ownerUin"),poster:{id:n.uin,name:n.name,platform:n.t1_source},CommentViewModel:i.CommentViewModel.derive({className:"moodCommentViewModel",methods:{
getReportData:function(){var e=this;return{appname:"qzone",subapp:"shuoshuo_comment",jubaotype:"article",t1_tid:(e.getByPath("topic.id")||"").replace(e.getByPath("topic.poster.id")+"_",""),t1_uin:e.getByPath("topic.poster.id"),t1_source:e.getByPath("topic.platform")||1,t2_tid:e.getByPath("id"),t2_uin:e.getByPath("poster.id"),evaluin:e.getByPath("poster.uin")}}}}),cgiUrls:{entopComment:format(l+"{domain}/cgi-bin/emotion_cgi_addtopcomment_v6",{domain:"qzone.qq.com"}),loadComments:format(l+"{domain}/cgi-bin/emotion_cgi_getcmtreply_v6?need_private_comment=1",{domain:"qzone.qq.com",domainPrefix:t.tab=="mine"?c:""}),postComment:format(l+"{domain}/cgi-bin/emotion_cgi_addcomment_ugc",{domain:"qzone.qq.com"}),removeComment:format(l+"{domain}/cgi-bin/emotion_cgi_delcomment_ugc",{domain:"qzone.qq.com"}),postReply:format(l+"{domain}/cgi-bin/emotion_cgi_addreply_ugc",{domain:"qzone.qq.com"}),removeReply:format(l+"{domain}/cgi-bin/emotion_cgi_delreply_ugc",{domain:"qzone.qq.com"})},strategy:{
isAbleTo:t.isAbleTo},request:a.create({get_onReceived:function(e){if(e.code!==0){e.code=0;e.message="";e.data={comments:[]}}}})};if(controller.tab=="mine"||controller.tab=="detail"){u.CommentListViewModel=i.CommentListViewModel.derive({properties:{pageNum:{initialValue:function(){if(controller.tab=="detail"){return 1}return 0}()},pageSize:{initialValue:function(){if(controller.tab=="detail"){return 20}return 5}()},order:{initialValue:0}},methods:{load:function(){var e=this.getPageNum();var t=this.getTopic();if(controller.tab=="detail"){if(t&&e===1&&n.commentlist&&n.commentlist.length){this.setSourceData({comments:controller.adaptMoodCommentData(n.commentlist),total:n.cmtnum});this.load=arguments.callee.base;return}}else{if(t&&e===0&&n.commentlist&&n.commentlist.length){this.setSourceData({comments:controller.adaptMoodCommentData(n.commentlist),total:n.cmtnum});this.load=arguments.callee.base;return}}return arguments.callee.base.apply(this,arguments)}}})}else{
u.CommentListViewModel=i.CommentListViewModel.derive({properties:{pageNum:{initialValue:0},pageSize:{initialValue:5},coverPageSize:{initialValue:5},converOrder:{initialValue:1}}})}var d=controller.commentModuleConfig;d.commentBoxConfig.checkBoxConfig=t.extendCommentSync(n);MOOD.commentModule[n.tid]=e.create({config:d,dataContext:i.create(u),placeHolder:$("comment_list_"+n.tid)});o&&o(MOOD.commentModule[n.tid])}})})},actionResponse:function(e){switch(MOOD.env.action){case"comment":if(e){e.show();e.focus()}break;case"forward":break;default:break}},appScrollHandler:function(){console.log("appScrollHandler")},viewport_:function(e){e=e||window;var t=0;if(typeof e.pageYOffset=="number"){t=e.pageYOffset}else if(e.document.body&&e.document.body.scrollTop){t=e.document.body.scrollTop}else if(e.document.documentElement&&e.document.documentElement.scrollTop){t=e.document.documentElement.scrollTop}var o=e.innerHeight||e.document.documentElement.clientHeight||e.document.body.clientHeight;return{
top:t,bottom:t+o,height:o}},getFrameNode:function(){var e;if(parent.g_version==5){e=parent.QZFL.dom.get("frameContainer")}else{e=parent.QZFL.dom.get("LayPageContainer")||parent.QZFL.dom.get("pageApp")}return e},isVisiable:function(e){var o=this.getFrameNode();var n=o?o.scrollTop:0;var i=t.viewport_(parent);var a=$e(e);var r=0;var s=QZFL.dom.getPosition(e);top_diff=s.top-i.bottom-n;bottom_diff=s.bottom-i.top-n;var c=top_diff<=r&&bottom_diff+r>=0;return c},loadIfVisiable:function(e,o){var n=e.getAttribute("data-img-load");var i=e.getAttribute("data-comment-load");var a=t.isVisiable(e);var r="rf=mood_app";var s=QZONE.FP._t.QZFL.cookie.get("QZ_FE_WEBP_SUPPORT")=="1";if(s){r+="&t=5"}var c=e.getAttribute("data-tid");if(a&&n!="load"){e.setAttribute("data-img-load","load");$e(e).find("img").each(function(){if($e(this).hasClass("typeset-lazyload")){$e(this).removeClass("typeset-lazyload");var e=this.getAttribute("data-src");var t=this.getAttribute("data-midsrc")
;var o=this.getAttribute("data-bigsrc");if((e||t||o).indexOf("http://p.qpimg.cn/cgi-bin/cgi_imgproxy")>-1){r=""}if(e&&r){e+=(e.indexOf("?")>-1?"&":"?")+r}if(t&&r){t+=(t.indexOf("?")>-1?"&":"?")+r}if(o&&r){o+=(o.indexOf("?")>-1?"&":"?")+r}var n=this.getAttribute("pic-width");var i=this.getAttribute("pic-height");var a=parseInt(this.getAttribute("pic-index"),10)+1;if(e){var s;QZFL.dom.searchChain(this,"parentNode",function(e){if(!e){return}if($e(e).hasClass("img-item-"+a)){s=e;return true}});var c=QZFL.dom.getSize(s);var l=c[0];var u=c[1];var d=l==400||u==400;var m=this;var f=new Image;f.onload=function(){if(this.width<l||this.height<u){if(this.width/this.height>l/u){m.height=u}else{m.width=l}if(n>u&&i>u){m.src=o}else{m.src=this.src}return}if(this.width/this.height>l/u){m.height=u}else{m.width=l}m.src=this.src};f.src=d?o:e}}if($e(this).hasClass("lazyload")){$e(this).removeClass("lazyload");if(this.hasAttribute("data-isvideo")){var p=this.getAttribute("data-src")||""
;this.setAttribute("src",p);return}var e=this.getAttribute("data-src");var g=this.getAttribute("data-isphoto");if(e.indexOf("http://p.qpimg.cn/cgi-bin/cgi_imgproxy")>-1){r=""}if(e){if(g==1&&r){e+=(e.indexOf("?")>-1?"&":"?")+r}var _=this.getAttribute("data-limit")||"";var h=_.split(",");if(h.length!=2){h=[400,300]}var v=h[0]==400;var w=$e(this.parentNode.parentNode).hasClass("js-small-video");QZFL.media.reduceImage(v?0:1,h[0],h[1],{trueSrc:e,img:this,callback:function(e,t,o,n,i){if(w&&i.ow&&i.oh){var a=parseInt(QZFL.dom.getStyle(e,"width"),10),r=parseInt(QZFL.dom.getStyle(e,"height"),10),s=i.oh/i.ow,c,l;if(s<=r/a){l=r;c=r/s}else{c=a;l=a*s}if(c>400){c=400;l=a*s}e.style="width:"+c+"px;height:"+l+"px";return}if(v){return}var a=parseInt(QZFL.dom.getStyle(e,"width"),10),r=parseInt(QZFL.dom.getStyle(e,"height"),10);var u=-(r-n)/2,d=-(a-o)/2;if(u){QZFL.dom.setStyle(e,"margin-top",u+"px")}if(d&&d<0){QZFL.dom.setStyle(e,"margin-left",d+"px")}}})}}})}if(a&&i!="load"){
e.setAttribute("data-comment-load","load");var l=MOOD.DataStorage.get(c);if(!l){console.log("tid:"+c);return}if(l.data.right>1){return}qzlog.info({cm:"MOOD_APP",cf:"initCommentModule-"+o+" START"});t.initCommentModule(l.data,t.tab=="detail"?function(){t.actionResponse();qzlog.info({cm:"MOOD_APP",cf:"initCommentModule-"+o+" FINISHED"})}:function(){qzlog.info({cm:"MOOD_APP",cf:"initCommentModule-"+o+" FINISHED"})})}},loadVisiableItems:function(){qzlog.info({cm:"MOOD_APP",cf:"loadVisiableItems START"});var e=this;if(e.loadVisiableItems._loadTimer){return}e.loadVisiableItems._loadTimer=setTimeout(function(){var o=$e(".mod_feed_lst#msgList li.feed");var n=0;o.each(function(e,o){t.loadIfVisiable(this,o);if(e.getAttribute("data-like-handled")!=1&&n<10){n++;var i=e.getAttribute("data-tid");var a=MOOD.DataStorage.get(i);t.likeButton(a);e.setAttribute("data-like-handled",1)}});e.loadVisiableItems._loadTimer=null},100)},resetScrollHandler:function(){t._scroll_timer=null;t._min_scroll_time=200
;t._last_scroll_time=0;t._last_scroll_top=0},_scroll_timer:null,_min_scroll_time:200,_last_scroll_time:0,_last_scroll_top:0,scrollHandler:function(){if(!t._scroll_timer){var e=(new Date).getTime();var o=t._min_scroll_time;if(e-t._last_scroll_time>t._min_scroll_time){o=0}t._scroll_timer=window.setTimeout(function(){t._last_scroll_time=(new Date).getTime();t.loadVisiableItems();var e=QZONE.FP._t.QZFL.dom.getClientHeight();var o=QZONE.FP._t.QZFL.dom.getScrollTop();var n=QZONE.FP._t.QZFL.dom.getScrollHeight();if(t.tab=="feedlist"&&e+o>n-200&&o-10>t._last_scroll_top){t._last_scroll_top=o;if(t.mmc){t.mmc.fetch();console.log("滚动加载哦")}console.log(n,e+o,e,o)}t._scroll_timer=null},o)}},fixNum:function(){seajs.use("app/v8/requests/mood_request/1.0",function(e){e.get({id:"shuoshuoinfo_v6",data:{uin:t.uin},onSuccess:function(e){if(e&&e.total>=0){$e(".feed_num a").setHtml(e.total)}},onError:function(e){if(e==undefined){}}})})},loadBanner:function(){t.MenuHandler();if(isOwner){
QZFL.imports("/qzone/v6/v6_config/moodbanner.js")}},updateMenu:function(e){switch(e){case"detail":$e(".feed_wrap .feed_head").show();break;case"weibo":$e(".feed_wrap .feed_head").hide();$e(".nav_weibo").find("a").addClass("selected");break;case"feedlist":case"mine":case"schedule":$e(".feed_wrap .feed_head").show();$e(".nav_my").find("a").addClass("selected");break;case"index":$e(".feed_wrap .feed_head").hide();$e(".nav_home").find("a").addClass("selected");break;case"hot":$e(".feed_wrap .feed_head").hide();$e(".nav_hot").find("a").addClass("selected");break;default:$e(".feed_wrap .feed_head").hide()}},MenuHandler:function(){if(!QZONE.FP.getUserBitmap(41)||!QZONE.FP.getQzoneConfig("loginUin")){$e(".nav_weibo").addClass("none")}$e(".shuoshuo_menu ul li a").onClick(function(e){var o=QZFL.event.getTarget(e);if(o.getAttribute("id")=="menu_wall"||o.parentNode.getAttribute("id")=="menu_wall"){return true}QZFL.event.preventDefault(e);var n=$e(this).getAttr("data-tab")
;$e(".shuoshuo_menu ul li a").removeClass("selected");$e(this).addClass("selected");t.tab=n;if(!isQzone&&t.tab=="feedlist"){t.tab="mine"}if(t.tab=="hot"){t.getHotList(1,function(){t.load(t.tab)})}else{t.load(t.tab)}t.updateMenu(t.tab);t.updateTitle();t.resetScrollHandler();return false});t.updateMenu(t.tab)},userTracker:function(e){if(document.domain!="qq.com"){return}var t={uin:"",mod:0,src:9,id:""};QZFL.object.extend(t,e);var o="http://g.qzone.qq.com/cgi-bin/friendshow/cgi_content_visitor";var n=new QZFL.FormSender(o,"POST",t,"utf-8");n.onSuccess=function(e){};n.send()}});var t=t||controller;QZFL.object.extend(controller,{load:function(e,o){if(window._preloadCache&&window._preloadCache.code==9999){window._preloadCache=null}else if(window._preloadCache&&window._preloadCache.code==0){window._preloadCache.msglist=window._preloadCache.msglist||window._preloadCache.posts}t.updateTitle(window._preloadCache);t.updateCurrentTabStyle(e);MOOD.commentModule={};MOOD.load("*",function(o){
t.mmc=new o.MoodModelCollection({uin:t.uin,type:e,hostUin:t.uin,initialData:window._preloadCache,success:function(o){if(!window._preloadCache){o.setConfig({mood:{comment:{max_comments_count:0}}});var n=document.getElementById("msgList");var i=o.getPagination();if(t.tab=="feedlist"&&i.page>1){QZFL.dom.insertAdjacent(n,2,o.getHTML())}else{if(QZFL.object.route(o,"opts.initialData.code")<0){console.log("[ERROR] mood/index.js controller.load 加载数据异常，错误码:",QZFL.object.route(o,"opts.initialData.code"));n.innerHTML=QZFL.object.route(o,"opts.initialData.message")||QZFL.object.route(o,"opts.initialData.msg")||"";return}if(o.getSizeSync()>0){n.innerHTML=o.getHTML()}else{n.innerHTML=t.getEmptyPageTip()}}}controller.onPageRendered(e,o)}});if(!window._preloadCache){t.mmc.fetch()}else{window._preloadCache=null}})},init:function(){qzlog.info({cm:"MOOD_APP",cf:"controller.init START"});t.reportPV();new MOOD.MsgList({container:"msgList"});$e(".profile").setHtml(t.getProfileHtml())
;if(window._preloadCache&&window._preloadCache.code===9999){document.getElementById("error_tip_cont").style.display="block"}t.showReview();if(window._preloadCache&&window._preloadCache.code!=9999){t.load(t.tab)}MOOD.poster.init("poster");t.getLastCommentHtml();var e=MOOD.util.getHttpParams("referer");if(e&&e.indexOf("hot_topic")!=-1){$("hot_topic_bd").onclick=function(e){var t=QZFL.event.getTarget(e);while(t&&t!=this){if(t.className=="topic_item"){MOOD.sendHotClick("/hottopic_click");return}t=t.parentNode}};t.showHotWords();$("msgList").setAttribute("data-tab","hot_topic")}t.eventHandler();t.loadBanner();t.runStyleFailedMonitor();switch(t.tab){case"hot":t.updateNickname();t.updateCount();break;case"feedlist":t.updateTabUrl();break;case"mine":t.updateTabUrl();break;case"schedule":break;case"detail":t.updateTabUrl();break;default:break}if(t.tab=="detail"){QZFL.event.addEvent(window,"hashchange",function(){window.console&&console.log("hashchange");try{window.location.reload()}catch(e){}})
}qzlog.info({cm:"MOOD_APP",cf:"controller.init FINISHED"})},eventHandler:function(){QZFL.event.removeEvent(parent,"scroll",t.scrollHandler);QZFL.event.addEvent(parent,"scroll",t.scrollHandler);try{var e;if(parent.g_version==5){e=parent.QZFL.dom.get("frameContainer")}else{e=parent.QZFL.dom.get("LayPageContainer")}QZFL.event.removeEvent(e,"scroll",t.scrollHandler);QZFL.event.addEvent(e,"scroll",t.scrollHandler)}catch(e){}QZFL.event.addEvent(window,"unload",function(){window.console&&console.log("mood app unload fired!");try{QZFL.event.removeEvent(parent,"scroll",t.scrollHandler);var e=parent.QZFL.dom.get("LayPageContainer");QZFL.event.removeEvent(e,"scroll",t.scrollHandler)}catch(e){}})},_reportString:function(e,t,o){try{if(!e){return}var n=window.TCISD;if(!n){n=MOOD.getStatPackage()}if(n&&n.stringStat){n.stringStat("1000100",{bid:e,rc:t},{reportRate:o||100})}}catch(e){}},initFavoriteWidget:function(){
window.seajs&&window.seajs.use(["app/favorite/script/favorite_for_app/1.0","jquery"],function(e,t){if(!e){return}if(!t){return}var o=QZONE.FP.getQzoneConfig().loginUin;t("#msgList").find(".add_favorite_container").each(function(n,i){var a=t(i);var r=a.parents("li:first");var s=r.attr("data-tid");var c=r.attr("data-uin");var l=e.init({data:{id:s,owneruin:c,uin:o},container:a[0],who:"shuoshuo"});if(l){if(a.hasClass("need_bg2")){t(l.template).mouseenter(function(){a.addClass("bg2")}).mouseleave(function(){a.removeClass("bg2")})}}});qzlog.info({cm:"MOOD_APP",cf:"init favorite widget FINISHED"})})},onPageRendered:function(e,o){var n=o;if(n.getSizeSync()>0){document.getElementById("error_tip_cont").style.display="none"}controller.initFavoriteWidget();var i=n.getPagination();qzlog.info({cm:"MOOD_APP",cf:"init pager widget START"});e!="feedlist"&&MOOD.widget.loadPager(function(){t.pager=new F4A.widget.Pager($("pager"),{pageSize:i.rowsPerPage,currentPage:i.page,totalNum:i.totalRecords,
onTurn:function(e){if(t.tab=="hot"){t.getHotList(e,function(e){t.load(t.tab,e)})}else{MOOD.commentModule={};t.mmc.fetch({page:e})}}});qzlog.info({cm:"MOOD_APP",cf:"init pager widget FINISHED"})});t.loadVisiableItems();if(e=="hot"){t.updateCount()}var a=frameElement&&QZFL.dom.getPosition(frameElement).top||0;var r=t.viewport_(parent).top;if(e!="feedlist"&&r>a){QZONE.FP.setScrollTop(0)}t.reportPV();if(e==="detail"&&top.window.g_point0_311){this.reportSpeed({points:{siteName:top.location.host,pageName:"311/"+e,24:(new Date).getTime()-top.window.g_point0_311},appid:"20141",appkey:"c373ba4a1ce77b27601e887e9f8eb3f4"})}else{top.window.g_point0_311=null}},runStyleFailedMonitor:function(){try{var e=$e(".network_busy").getStyle("display");if(e==="block"){window.console&&console.log("load css failed");t.pingCDN(function(e){e.uin=MOOD.env.getLoginUin();window.console&&console.log("go css failed");t._reportString("101004",obj2str(e),100)})}}catch(e){}},pingCDN:function(e){var t={};var o=new Date
;var n=new Image;var i;n.onload=function(){this.onload=null;i=new Date-o};setTimeout(function(){if(!i){i=-1}t.timetocdn=i;try{t.ie=ua.ie;t.chrome=ua.chrome;t.firefox=ua.firefox}catch(e){}e&&e(t)},3e3);n.src="http://qzonestyle.gtimg.cn/qzone/app/mood_v6/images/blank.gif?r="+Math.random()},showHotMood:function(){var e=$e(".feed_commend_note");e.removeClass("none");if(t.showHotMood._inited){$e(".feed_commend").hide();return}e.onClick(function(){$e(".feed_commend").show();QZFL.imports("/qzone/app/mood_v6/plugin/popular_mood.js",function(){QZONE.FP._t.MoodUseHot=window.UseHot=new HotMood})});e.onHover(function(){e.addClass("bg2")});e.onMouseOut(function(){e.removeClass("bg2")});t.showHotMood._inited=true},hideHotMood:function(){$e(".feed_commend_note").addClass("none");$e(".feed_commend").hide()},showHotWords:function(){var e="http://r.qzone.qq.com/cgi-bin/right_frame.cgi";var o={uin:QZONE.FP.getQzoneConfig("loginUin"),param:4};var n=new QZFL.JSONGetter(e,"_get"+Math.random(),o,"utf-8")
;n.onSuccess=function(e){if(e.code==0){var o=e.data.module_4.data;MOOD.hot_topic=o;t.refreshHotWords()}};n.onError=function(e){};n.send("_Callback")},refreshHotWords:function(){var e=MOOD.hot_topic||[];MOOD.lang.randomArray(e);var t="";for(var o=0;o<e.length&&o<3;o++){t+=e[o].html}if(t){t=t.replace(/_blank/g,"_top");$("hot_topic_bd").innerHTML=t;$e("#hot_topic").removeClass("none")}},showRecVideo:function(){var e="http://boss.qzone.qq.com/fcg-bin/fcg_get_strategy";var t={uin:QZONE.FP.getQzoneConfig("loginUin"),board_id:2049};var o=new QZFL.JSONGetter(e,"_get"+Math.random(),t,"utf-8");o.onSuccess=function(e){if(e.code==0){var t=JSON.parse(e.data["2049"].items[0].extdata);var o=['<div class="mod-sec-hd">',"<h3>{text}</h3>","</div>",'<div class="mod-sec-bd">','<div class="vedio-wrap">','<img src="{picUrl}" data-link="{link}" />','<a href="{link}" target="_top" class="btn-play-m {isVideo}" role="button"><i class="hide_clip">播放</i></a>',"</div>","</div>"].join("");o=format(o,t)
;$("rec_vedio").innerHTML=o;$e("#rec_vedio").removeClass("none")}};o.onError=function(e){};o.send("_Callback")},dolike:function(e){var t=e&&e.getAttribute("key");if(!t){return}var o="http://"+top.g_W_Domain+"/cgi-bin/likes/internal_dolike_app";sd=new QZFL.FormSender(o,"post",{opuin:top.g_iLoginUin,unikey:t,curkey:t,from:0},"gb2312");sd.onSuccess=function(o){if(o.ret==0){var n='<a href="{key}?referer=hot_topic" target="_top"><span class="act_text c_tx">看详情</span></a>';n=format(n,{key:t});$e(e).find(".topic_op").setHtml(n)}};sd.send()},getEmptyPageTip:function(){var e="";switch(t.tab){case"weibo":e='<img class="empty_pic_message" src="http://ctc.qzonestyle.gtimg.cn/qzone_v6/img/shuoshuo/empty_home_sync.png">';break;case"index":e='<img class="empty_pic_message" src="http://ctc.qzonestyle.gtimg.cn/qzone_v6/img/shuoshuo/empty_feed_post.png">';break;case"feedlist":case"mine":if(isOwner){
e='<img class="empty_pic_message" src="http://ctc.qzonestyle.gtimg.cn/qzone_v6/img/shuoshuo/empty_home_post.png">'}else{e='<img class="empty_pic_message" src="http://ctc.qzonestyle.gtimg.cn/qzone_v6/img/shuoshuo/empty_guest_post.png">'}break;case"schedule":e='<img class="empty_pic_message" src="http://ctc.qzonestyle.gtimg.cn/qzone_v6/img/shuoshuo/empty_timing_post.png">';break;case"detail":e="该条说说已被删除"}return e},reportPV:function(){t.isIndex=false;switch(t.tab){case"detail":MOOD.sendPV("detail");break;case"list":MOOD.sendPV("microblog");break;case"mine":if(isOwner){MOOD.sendPV("mytitle")}else{MOOD.sendPV("guesttitle")}break;case"timer":MOOD.sendPV("timer");break;case"index":MOOD.sendPV("title");break;default:MOOD.sendPV(t.tab)}},reportSpeed:function(e){e=e||{};e.points=e.points||{};if(!e.points.siteName||!e.points.pageName||!e.points[24]){console.log("需要siteName,pageName,24号上报点");return}e.points.flag5=1;var t=n({appid:e.appid||"20141",
appkey:e.appkey||"c373ba4a1ce77b27601e887e9f8eb3f4",speedparams:n(e.points),apn:e.apn||"wifi",device:e.device||"iPhone",platform:e.platform||"ios",app:e.app||"qq",_:Math.random()});(new Image).src="https://huatuo.weiyun.com/report.cgi?"+t;if(window.isAlpha){var o=new XMLHttpRequest;o.open("POST","https://h5.qzone.qq.com/log/post/speedlog",true);o.setRequestHeader("Content-Type","text/plain");o.withCredentials=true;o.send("speedlog"+e.points.pageName+": "+JSON.stringify(e.points,null,2)+"\r\n");(new Image).src="https://h5.qzone.qq.com/log/post/speedlog?"+t}console.log("上报成功：");console.log(e.points);function n(e){var t=[];for(var o in e){if(e.hasOwnProperty(o)){if(e[o]!==""&&e[o]!==undefined){t.push(o+"="+encodeURIComponent(e[o]))}}}return t.join("&")}},showReview:function(){var e=window._preloadCache;var t=$("censor_count");if(t&&e){t.innerHTML="当前待审核评论 ("+(e.censor_count||0)+")"}},getLocalDb:function(e){if(QZONE.FP.noShareDb){try{return QZONE.FP.noShareDb.get(e)}catch(e){}}return""},
setLocalDb:function(e,t){if(QZONE.FP.noShareDb){try{QZONE.FP.noShareDb.set(e,t);return true}catch(e){}}return false},getHotPageNum:function(){var e=t.getLocalDb("mood_hot_page_time");if(e){var o=function(e){var t=8.5*60*60*1e3-8*60*60*1e3;var o=24*60*60*1e3;var n=Math.floor((e-t)/o);return n};var n=QZONE.FP.getSvrTime();var i=o(parseInt(e));var a=o(n.getTime());if(i==a){var r=t.getLocalDb("mood_hot_page_num");r=parseInt(r);return r?r+1:1}}return 1},getHotList:function(e,o){var n=t.getHotPageNum();var i=OOP.tpl.format("//{{siDomain}}/qzone_v6/act/hotTopic/top20_{{random}}.js",{siDomain:siDomain,random:n});var a=new QZFL.JSONGetter(i,null,{},"utf-8");a.onSuccess=function(i){var a=[];var r=window._LocalCacheCallbackData=i;for(var s=0;s<r.data.length&&s<20;s++){a.push(window._fakeData(r.data[s]))}MOOD.lang.randomArray(a);window._LocalCacheData=window._LocalCacheData||{};window._LocalCacheData.msglist=a;window._LocalCacheData.total=r.totalCnt;window._preloadCache=window._LocalCacheData;o(e)
;var c=QZONE.FP.getSvrTime();t.setLocalDb("mood_hot_page_num",n);t.setLocalDb("mood_hot_page_time",c.getTime())};a.send("_Callback")},updateNickname:function(){var e=[];$e(".mod_feed_lst#msgList li.feed").each(function(){var t=this.getAttribute("data-tid");var o=MOOD.DataStorage.get(t);if(o){e.push(o.data.uin)}});QZFL.FP.getPortraitList(e,function(e){$e(".nickname").each(function(t){var o=$e(this);var n=o.getAttr("data-uin");try{if(typeof e[n+""]!="undefined"){o.setHtml(escHTML(restHTML(e[n][6])))}}catch(e){}})})},updateCurrentTabStyle:function(e){e=e||t.tab;var o=".feed_tab";if(e=="feedlist"){o+=" .all_tab"}else if(e=="mine"){o+=" .mood_tab"}else if(e=="schedule"){o+=" .timer_tab"}if(!isOwner){o+="_visitor"}$e(".feed_tab a").removeClass("current");$e(o).addClass("current")},updateTabUrl:function(){var e=$e(".feed_tab .all_tab_visitor");var t=e.getAttr("href");var o=$e(".feed_tab .mood_tab_visitor");var n=o.getAttr("href")
;var i=MOOD.util.getHttpParams("uin")||QZONE.FP.getQzoneConfig("ownerUin");if(QZONE.FP.getQzoneConfig("isOwner")){if(i>1e4&&i!=QZONE.FP.getQzoneConfig("ownerUin")){e.setAttr("href",t+"&uin="+i);o.setAttr("href",n+"&uin="+i)}}else{e.setAttr("href",t+"&uin="+i);o.setAttr("href",n+"&uin="+i)}},updateCount:function(){var e;var t=[];var o={};$e(".mod_feed_lst#msgList li.feed").each(function(){var n=this.getAttribute("data-tid");var i=MOOD.DataStorage.get(n);if(i&&!this.getAttribute("data-countloaded")){var a=i.data;e=["http://user.qzone.qq.com/",a.uin,"/mood/",a.tid,".",a.t1_source].join("");t.push(e);o[["http://user.qzone.qq.com/",a.uin,"/mood/",a.tid].join("")]=format("{uin}_{tid}_{t1_source}",a);this.setAttribute("data-countloaded",1)}});var n="http://rsh.qzone.qq.com/cgi-bin/user/qz_opcnt2_sh";var i={fupdate:1,unikey:t.join("<|>"),rd:Math.random()};var a=new QZFL.JSONGetter(n,null,i,"utf-8");a.onSuccess=function(e){if(e.code==0){e.data=e.data||[];var t;for(var n=0;n<e.data.length;n++){
var i=e.data[n];t=i.current.newdata;if(o[i.current.key]){var a="comment_btn_"+o[i.current.key];var r="forward_btn_"+o[i.current.key];if(t.CS>0&&$(a)){$(a).innerHTML=format("评论({CS})",t)}if(t.ZS>0&&$(r)){$(r).innerHTML=format("转发({ZS})",t)}}}}};a.onError=function(){};a.send("_Callback")}});MOOD.updateFeeds=t.updateFeeds;QZFL.event.onDomReady(function(){timeStampsPool[7]=new Date;if(top==window){$e(document.body).setStyle("width","900px").setStyle("margin","0 auto")}gTimeStampsPool[2]=new Date;MOOD.domain.load();MOOD.pageStart(controller.init);gTimeStampsPool[3]=new Date;timeStampsPool[8]=new Date;setTimeout(function(){var e=Math.floor(Math.random()*10)<3;var t=6;if(typeof t!="undefined"&&e){var o=t||0;var n=MOOD.getStatPackage().createTimeStat("moodPageTime"+o,[175,367,o]);n.zero=gTimeStampsPool[0];n.timeStamps=gTimeStampsPool;n.report()}var i={mine:[175,367,23],detail:[175,367,24]};var a=i[MOOD.env.tab];if(a){var r=MOOD.getStatPackage().createTimeStat("moodPageTime_"+MOOD.env.tab,a)
;r.zero=timeStampsPool[0];r.timeStamps=timeStampsPool;r.report()}if(QZFL.userAgent.ie&&QZFL.userAgent.ie>=9){window._timing_config={f1:175,f2:367,f3:9};QZFL.imports("/qzone/app/timing/timing.js",function(){})}},0);if(document.domain=="pengyou.com"){var e=$e("body");e&&e.addClass("mod_py")}$e(".mod_tab_nav").removeClass("none");MOOD.TCISDClick.batchBind({"#msgList[data-tab=hot_topic] .ft .op .qz_like_btn":"hot_topic.likeButton","#msgList[data-tab=hot_topic] .ft .op .comment_btn":"hot_topic.commentButton","#msgList[data-tab=hot_topic] .ft .op .forward_btn":"hot_topic.forwardButton",".mod_tab_op a":"old_mood_entry"})});qzlog.info({cm:"MOOD_APP",cf:"LOAD_JS_FINISHED"});gTimeStampsPool[1]=new Date;timeStampsPool[6]=new Date;